<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L2 Server Diagnostics Guide v4.0</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Segoe UI, Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; background: #f5f5f5; }
        .container { max-width: 1100px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%); color: white; padding: 40px; margin-bottom: 30px; }
        .header h1 { font-size: 2em; margin-bottom: 10px; }
        .section { background: white; padding: 30px; margin-bottom: 20px; }
        .section h2 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; margin-bottom: 20px; }
        .section h3 { color: #333; margin: 20px 0 10px 0; }
        .code-block { background: #2d2d2d; color: #f8f8f2; padding: 15px; margin: 15px 0; font-family: Consolas, monospace; font-size: 13px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th { background: #2c3e50; color: white; padding: 12px; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #ddd; }
        tr:hover { background: #f8f9fa; }
        ul, ol { margin-left: 20px; margin-bottom: 15px; }
        li { margin: 8px 0; }
        .footer { text-align: center; padding: 30px; color: #666; }
        p { margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>L2 Server Diagnostics Guide</h1>
            <p>Windows Server Troubleshooting for L2 Support</p>
            <p>Version 4.0 | Author: Syed Rizvi</p>
        </div>
        
        <section class="section">
            <h2>1. Overview</h2>
            <p>This guide provides L2 support staff with tools for diagnosing and resolving common Windows Server issues. The toolkit includes two PowerShell scripts.</p>
            
            <h3>Audit Script (Read-Only)</h3>
            <p>Collects diagnostic information without making any changes to the server. Creates both CSV and HTML reports with 25 comprehensive checks covering system health, security tools, services, and more. Use this FIRST to identify issues before attempting any fixes.</p>
            
            <h3>Fix Script (With Prompts)</h3>
            <p>Provides 12 fix operations with prompts before each action. You must approve each fix individually. All actions are logged for documentation. Use this AFTER running the audit to fix identified issues.</p>
            
            <h3>Report Locations</h3>
            <p>All reports automatically save to TWO locations:</p>
            <ul>
                <li>Your Desktop folder</li>
                <li>C:\L2_Reports (created automatically if it does not exist)</li>
            </ul>
        </section>
        
        <section class="section">
            <h2>2. How to Run the Scripts</h2>
            
            <h3>Step-by-Step Instructions</h3>
            <ol>
                <li><strong>Open PowerShell as Administrator</strong> - Right-click on PowerShell and select "Run as Administrator"</li>
                <li><strong>Navigate to the script location</strong></li>
            </ol>
            <div class="code-block">cd C:\Scripts</div>
            
            <ol start="3">
                <li><strong>Run the AUDIT script first</strong></li>
            </ol>
            <div class="code-block">.\L2-ServerDiagnostics-Audit-v4.ps1</div>
            
            <ol start="4">
                <li><strong>Review the audit report</strong> - Look for any items marked as CRITICAL, WARNING, or STOPPED</li>
                <li><strong>Run the FIX script if needed</strong></li>
            </ol>
            <div class="code-block">.\L2-ServerDiagnostics-Fix-v4.ps1</div>
            
            <ol start="6">
                <li><strong>Run the AUDIT again to verify</strong> - Confirm the issues are resolved</li>
            </ol>
            
            <h3>Output Files</h3>
            <table>
                <tr><th>File</th><th>Description</th><th>Use For</th></tr>
                <tr><td>L2_Audit_SERVERNAME_timestamp.csv</td><td>Comma-separated values file</td><td>Excel analysis, filtering, sorting</td></tr>
                <tr><td>L2_Audit_SERVERNAME_timestamp.html</td><td>Visual HTML report</td><td>Quick review, sharing with team</td></tr>
                <tr><td>L2_Fix_Log_SERVERNAME_timestamp.txt</td><td>Fix action log</td><td>Documentation of changes made</td></tr>
            </table>
        </section>
        
        <section class="section">
            <h2>3. The 25 Checks Explained</h2>
            <p>The audit script performs 25 comprehensive checks:</p>
            
            <table>
                <tr><th>#</th><th>Check</th><th>What It Does</th><th>Why It Matters</th></tr>
                <tr><td>1</td><td>System Info</td><td>Gets computer name, OS version, uptime</td><td>Basic identification and uptime tracking</td></tr>
                <tr><td>2</td><td>Windows Activation</td><td>Checks if Windows is licensed</td><td>Unlicensed servers are compliance violations</td></tr>
                <tr><td>3</td><td>Trust Relationship</td><td>Tests secure channel to domain</td><td>Broken trust prevents domain logins</td></tr>
                <tr><td>4</td><td>Group Policy</td><td>Checks for GPO errors in last 7 days</td><td>GPO failures cause policy enforcement issues</td></tr>
                <tr><td>5</td><td>AD Replication</td><td>Checks replication status (DCs only)</td><td>Replication failures affect entire domain</td></tr>
                <tr><td>6</td><td>CPU Usage</td><td>Gets current CPU load percentage</td><td>High CPU causes slow performance</td></tr>
                <tr><td>7</td><td>Top Processes</td><td>Lists top 5 CPU and memory consumers</td><td>Identifies resource-hungry applications</td></tr>
                <tr><td>8</td><td>Memory Usage</td><td>Gets RAM usage percentage</td><td>High memory causes performance issues</td></tr>
                <tr><td>9</td><td>Page File</td><td>Checks virtual memory usage</td><td>Full page file can cause crashes</td></tr>
                <tr><td>10</td><td>Disk Space</td><td>Checks free space on all drives</td><td>Low disk causes application failures</td></tr>
                <tr><td>11</td><td>Critical Services</td><td>Checks 13 essential Windows services</td><td>Stopped services cause various failures</td></tr>
                <tr><td>12</td><td>NIC Teaming</td><td>Checks network adapter team status</td><td>Broken team causes network outages</td></tr>
                <tr><td>13</td><td>SSL Certificates</td><td>Finds expired or expiring certs</td><td>Expired certs cause application outages</td></tr>
                <tr><td>14</td><td>Security Tools</td><td>Checks Nessus, Trellix, Trend, etc.</td><td>Security tools must be running for compliance</td></tr>
                <tr><td>15</td><td>Time Sync</td><td>Checks if time is synced to domain</td><td>Time drift breaks Kerberos authentication</td></tr>
                <tr><td>16</td><td>Pending Reboot</td><td>Checks if server needs restart</td><td>Pending reboots can cause instability</td></tr>
                <tr><td>17</td><td>RDP Status</td><td>Checks if Remote Desktop is enabled</td><td>Disabled RDP prevents remote access</td></tr>
                <tr><td>18</td><td>Firewall</td><td>Checks firewall profile status</td><td>Firewall state affects connectivity</td></tr>
                <tr><td>19</td><td>Scheduled Tasks</td><td>Finds failed tasks in last 7 days</td><td>Failed tasks mean missed jobs</td></tr>
                <tr><td>20</td><td>Backup Status</td><td>Checks Windows Server Backup</td><td>Failed backups risk data loss</td></tr>
                <tr><td>21</td><td>Failed Logins</td><td>Counts failed logins in last 24 hours</td><td>High count may indicate attack</td></tr>
                <tr><td>22</td><td>Event Errors</td><td>Gets last 20 error events</td><td>Shows recent system problems</td></tr>
                <tr><td>23</td><td>Network</td><td>Tests connectivity to DC</td><td>Network issues affect all services</td></tr>
                <tr><td>24</td><td>Patches</td><td>Lists recent hotfixes</td><td>Unpatched servers are vulnerable</td></tr>
                <tr><td>25</td><td>Summary</td><td>Counts critical, high, warning issues</td><td>Quick health overview</td></tr>
            </table>
        </section>
        
        <section class="section">
            <h2>4. Security Tools Monitoring</h2>
            <p>The audit script checks for the following security tools and their status:</p>
            
            <h3>Tenable Nessus Agent</h3>
            <p>Service Name: Tenable Nessus Agent</p>
            <p>Installation Path: C:\Program Files\Tenable\Nessus Agent</p>
            <p>Checks: Is the service running? Is the agent linked to Tenable server?</p>
            <p>If Not Linked: Contact your security team for the linking key.</p>
            <div class="code-block">cd "C:\Program Files\Tenable\Nessus Agent"
.\nessuscli.exe agent status</div>
            
            <h3>Trellix (McAfee)</h3>
            <p>Services Checked: macmnsvc, masvc, mfefire, mfemms, McShield, McAfeeFramework</p>
            <p>If Stopped: Use the FIX script to restart security services.</p>
            
            <h3>Trend Micro</h3>
            <p>Services Checked: ds_agent, TmListen, ntrtscan</p>
            <p>If Stopped: Use the FIX script to restart security services.</p>
            
            <h3>Other Tools</h3>
            <p>CrowdStrike: CSFalconService</p>
            <p>Windows Defender: WinDefend</p>
        </section>
        
        <section class="section">
            <h2>5. Common Issues and How to Fix Them</h2>
            
            <h3>Issue: Trust Relationship Broken</h3>
            <p><strong>Symptoms:</strong></p>
            <ul>
                <li>Users cannot log in with domain accounts</li>
                <li>Authentication errors when accessing network resources</li>
            </ul>
            <p><strong>How to Fix:</strong></p>
            <ol>
                <li>Run the FIX script</li>
                <li>Select "Repair Trust Relationship" when prompted</li>
                <li>Enter Domain Admin credentials when asked</li>
                <li>Run the AUDIT script again to verify</li>
            </ol>
            <p>If Still Broken: Escalate to L3</p>
            
            <h3>Issue: High CPU Usage</h3>
            <p><strong>Symptoms:</strong></p>
            <ul>
                <li>Server slow or unresponsive</li>
                <li>CPU shows greater than 80% in audit report</li>
            </ul>
            <p><strong>How to Investigate:</strong></p>
            <ol>
                <li>Check the "Top Processes" section in the audit report</li>
                <li>Identify which process is consuming CPU</li>
                <li>Contact application team if it is their application</li>
            </ol>
            <p>If Unknown Process: Escalate to L3 or Security team</p>
            
            <h3>Issue: Low Disk Space</h3>
            <p><strong>Symptoms:</strong></p>
            <ul>
                <li>Drive shows less than 20% free in audit</li>
                <li>Applications failing to write files</li>
            </ul>
            <p><strong>How to Fix:</strong></p>
            <ol>
                <li>Run the FIX script</li>
                <li>Select "Clean Temp Files" when prompted</li>
                <li>Contact application team if logs are filling disk</li>
            </ol>
            
            <h3>Issue: Critical Service Stopped</h3>
            <p><strong>Symptoms:</strong></p>
            <ul>
                <li>Service shows STOPPED in audit report</li>
                <li>Related functionality not working</li>
            </ul>
            <p><strong>How to Fix:</strong></p>
            <ol>
                <li>Run the FIX script</li>
                <li>The script will detect stopped services</li>
                <li>Approve restarting each service when prompted</li>
            </ol>
            
            <h3>Issue: Time Not Synced</h3>
            <p><strong>Symptoms:</strong></p>
            <ul>
                <li>Audit shows time source as "Local" instead of domain</li>
                <li>Kerberos authentication failures</li>
            </ul>
            <p><strong>How to Fix:</strong></p>
            <ol>
                <li>Run the FIX script</li>
                <li>Select "Force Time Sync" when prompted</li>
            </ol>
            
            <h3>Issue: SSL Certificate Expiring or Expired</h3>
            <p><strong>Symptoms:</strong></p>
            <ul>
                <li>Audit shows certificate expiring in less than 30 days</li>
                <li>Application showing certificate errors</li>
            </ul>
            <p><strong>How to Handle:</strong></p>
            <ol>
                <li>Note the certificate name from the audit report</li>
                <li>Identify which application uses it</li>
                <li>Create a ticket for certificate renewal</li>
                <li>Escalate to L3 or application team</li>
            </ol>
            
            <h3>Issue: Failed Login Attempts</h3>
            <p><strong>Symptoms:</strong></p>
            <ul>
                <li>Audit shows high number of failed logins</li>
                <li>User accounts getting locked out</li>
            </ul>
            <p><strong>How to Handle:</strong></p>
            <ul>
                <li>If less than 20: Normal, no action needed</li>
                <li>If 20-50: Monitor, may be user error</li>
                <li>If greater than 50: Escalate to Security team immediately</li>
            </ul>
        </section>
        
        <section class="section">
            <h2>6. Safe Commands Reference</h2>
            <p>These commands are safe for L2 to run manually if needed:</p>
            
            <table>
                <tr><th>Purpose</th><th>Command</th><th>What It Does</th></tr>
                <tr><td>Refresh Group Policy</td><td>gpupdate /force</td><td>Reapplies all group policy settings</td></tr>
                <tr><td>Check GPO Results</td><td>gpresult /r</td><td>Shows applied group policies</td></tr>
                <tr><td>Sync Time</td><td>w32tm /resync /force</td><td>Forces time sync with domain</td></tr>
                <tr><td>Flush DNS</td><td>Clear-DnsClientCache</td><td>Clears local DNS cache</td></tr>
                <tr><td>Register DNS</td><td>ipconfig /registerdns</td><td>Re-registers DNS records</td></tr>
                <tr><td>List Stopped Services</td><td>Get-Service | Where Status -eq Stopped</td><td>Shows all stopped services</td></tr>
                <tr><td>Start a Service</td><td>Start-Service -Name "ServiceName"</td><td>Starts a specific service</td></tr>
                <tr><td>Check CPU</td><td>Get-WmiObject Win32_Processor | Select LoadPercentage</td><td>Shows current CPU usage</td></tr>
                <tr><td>Check Disk Space</td><td>Get-PSDrive C | Select Used,Free</td><td>Shows C: drive usage</td></tr>
                <tr><td>View Recent Errors</td><td>Get-WinEvent -LogName System -MaxEvents 20</td><td>Shows last 20 system events</td></tr>
                <tr><td>List Certificates</td><td>Get-ChildItem Cert:\LocalMachine\My</td><td>Lists installed certificates</td></tr>
                <tr><td>Check NIC Team</td><td>Get-NetLbfoTeam</td><td>Shows NIC team status</td></tr>
            </table>
        </section>
        
        <section class="section">
            <h2>7. When to Escalate to L3</h2>
            <p>Escalate to L3 if any of the following situations occur:</p>
            
            <ul>
                <li>Trust relationship issues persist after running fix script</li>
                <li>AD replication failures detected on a Domain Controller</li>
                <li>Multiple Domain Controllers showing issues</li>
                <li>Server cannot contact ANY domain controller</li>
                <li>CPU consistently above 90% with no obvious cause</li>
                <li>SSL certificates expired for critical applications</li>
                <li>Greater than 50 failed login attempts in 24 hours</li>
                <li>NIC team completely down (network outage)</li>
                <li>Security tools cannot be started after multiple attempts</li>
                <li>Server blue screens or cannot boot</li>
                <li>Data corruption suspected</li>
            </ul>
            
            <h3>Information to Include When Escalating</h3>
            <p>Always provide the following when creating an L3 ticket:</p>
            <ul>
                <li>Audit Report - Attach both HTML and CSV from the audit</li>
                <li>Fix Log - Attach the fix script log if you ran it</li>
                <li>Steps Taken - List everything you already tried</li>
                <li>Error Messages - Include screenshots of any errors</li>
                <li>Server Info - Server name, IP address, role</li>
                <li>Timeline - When the issue started, any recent changes</li>
                <li>Business Impact - How many users affected, severity</li>
            </ul>
        </section>
        
        <section class="section">
            <h2>8. Quick Reference</h2>
            
            <h3>Workflow Summary</h3>
            <ol>
                <li>Open PowerShell as Administrator</li>
                <li>Run: .\L2-ServerDiagnostics-Audit-v4.ps1</li>
                <li>Review the HTML report for issues</li>
                <li>If issues found, run: .\L2-ServerDiagnostics-Fix-v4.ps1</li>
                <li>Approve fixes by typing Y when prompted</li>
                <li>Run audit again to verify fixes worked</li>
                <li>If issues persist, escalate to L3 with reports attached</li>
            </ol>
            
            <h3>Status Meanings in Reports</h3>
            <table>
                <tr><th>Status</th><th>Meaning</th><th>Action Required</th></tr>
                <tr><td>OK</td><td>Check passed, no issues</td><td>None</td></tr>
                <tr><td>INFO</td><td>Information only</td><td>None</td></tr>
                <tr><td>WARNING</td><td>Potential issue found</td><td>Review and consider fixing</td></tr>
                <tr><td>CRITICAL</td><td>Serious issue found</td><td>Fix immediately or escalate</td></tr>
                <tr><td>STOPPED</td><td>Service not running</td><td>Start the service</td></tr>
                <tr><td>ERROR</td><td>Error event found</td><td>Review event details</td></tr>
            </table>
            
            <h3>Thresholds</h3>
            <table>
                <tr><th>Metric</th><th>OK</th><th>Warning</th><th>Critical</th></tr>
                <tr><td>CPU Usage</td><td>Below 80%</td><td>80-90%</td><td>Above 90%</td></tr>
                <tr><td>Memory Usage</td><td>Below 80%</td><td>80-90%</td><td>Above 90%</td></tr>
                <tr><td>Disk Free Space</td><td>Above 20%</td><td>10-20%</td><td>Below 10%</td></tr>
                <tr><td>Failed Logins (24h)</td><td>Below 20</td><td>20-50</td><td>Above 50</td></tr>
                <tr><td>Days Since Patch</td><td>Below 60</td><td>60+ days</td><td>-</td></tr>
                <tr><td>Cert Expiration</td><td>Above 90 days</td><td>30-90 days</td><td>Below 30 days</td></tr>
            </table>
        </section>
        
        <div class="footer">
            <p>L2 Server Diagnostics Guide v4.0</p>
            <p>Author: Syed Rizvi</p>
            <p>For internal use only</p>
        </div>
    </div>
</body>
</html>
