<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L1 Windows Server Troubleshooting Guide</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f0f4f8; color: #333; line-height: 1.6; }
        .container { max-width: 1100px; margin: 0 auto; padding: 30px; }
        .header { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 40px; border-radius: 15px; margin-bottom: 30px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .section { background: white; border-radius: 12px; padding: 25px; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        .section h2 { color: #1e3c72; border-bottom: 3px solid #2a5298; padding-bottom: 10px; margin-bottom: 20px; font-size: 1.5em; }
        .section h3 { color: #2a5298; margin: 20px 0 15px 0; font-size: 1.2em; }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; padding: 12px 15px; text-align: left; font-weight: 600; }
        td { padding: 12px 15px; border-bottom: 1px solid #e0e0e0; }
        tr:nth-child(even) { background: #f8fafc; }
        tr:hover { background: #e8f4fc; }
        .code-block { background: #1e1e1e; color: #d4d4d4; padding: 15px 20px; border-radius: 8px; font-family: 'Consolas', 'Monaco', monospace; margin: 10px 0; overflow-x: auto; font-size: 14px; }
        .code-inline { background: #e8f4fc; color: #1e3c72; padding: 2px 8px; border-radius: 4px; font-family: 'Consolas', monospace; font-size: 13px; }
        .status-good { background: #d4edda; color: #155724; padding: 5px 12px; border-radius: 20px; font-weight: 600; display: inline-block; }
        .status-bad { background: #f8d7da; color: #721c24; padding: 5px 12px; border-radius: 20px; font-weight: 600; display: inline-block; }
        .status-warn { background: #fff3cd; color: #856404; padding: 5px 12px; border-radius: 20px; font-weight: 600; display: inline-block; }
        .alert { padding: 15px 20px; border-radius: 8px; margin: 15px 0; }
        .alert-danger { background: #f8d7da; border-left: 4px solid #dc3545; color: #721c24; }
        .alert-warning { background: #fff3cd; border-left: 4px solid #ffc107; color: #856404; }
        .alert-info { background: #d1ecf1; border-left: 4px solid #17a2b8; color: #0c5460; }
        .alert-success { background: #d4edda; border-left: 4px solid #28a745; color: #155724; }
        .step-number { background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); color: white; width: 30px; height: 30px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 10px; }
        .step { display: flex; align-items: flex-start; margin: 15px 0; }
        .step-content { flex: 1; }
        ul { margin: 10px 0 10px 25px; }
        li { margin: 8px 0; }
        .toc { background: #f8fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .toc a { color: #2a5298; text-decoration: none; display: block; padding: 5px 0; }
        .toc a:hover { color: #1e3c72; text-decoration: underline; }
        .footer { text-align: center; padding: 20px; color: #666; font-size: 0.9em; }
        @media print { .container { max-width: 100%; } .section { break-inside: avoid; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üñ•Ô∏è L1 Windows Server Troubleshooting Guide</h1>
            <p>Domain Connectivity & RDP Issues | Windows Server 2012 R2 - 2022</p>
        </div>

        <div class="section toc">
            <h2>üìã Table of Contents</h2>
            <a href="#section1">1. Initial Assessment</a>
            <a href="#section2">2. Common Error Messages</a>
            <a href="#section3">3. Step-by-Step Troubleshooting</a>
            <a href="#section4">4. Access Methods When RDP Fails</a>
            <a href="#section5">5. Resolution Procedures</a>
            <a href="#section6">6. Escalation Criteria</a>
            <a href="#section7">7. Quick Reference Commands</a>
        </div>

        <div class="section" id="section1">
            <h2>1. Initial Assessment</h2>
            <p>Before troubleshooting, gather the following information from the ticket:</p>
            <table>
                <tr><th>Information</th><th>Details to Collect</th></tr>
                <tr><td><strong>Server Name/IP</strong></td><td>Hostname or IP address of affected server</td></tr>
                <tr><td><strong>Domain Name</strong></td><td>Active Directory domain (e.g., corp.company.com)</td></tr>
                <tr><td><strong>Error Message</strong></td><td>Exact error message user is seeing</td></tr>
                <tr><td><strong>Last Working</strong></td><td>When did it last work correctly?</td></tr>
                <tr><td><strong>Recent Changes</strong></td><td>Any recent patches, updates, or changes?</td></tr>
                <tr><td><strong>Cloud Platform</strong></td><td>AWS, Azure, On-Premises, or Hybrid</td></tr>
            </table>
        </div>

        <div class="section" id="section2">
            <h2>2. Common Error Messages & Quick Fixes</h2>
            <table>
                <tr><th>Error Message</th><th>Likely Cause</th></tr>
                <tr>
                    <td><span class="status-bad">The trust relationship between this workstation and the primary domain failed</span></td>
                    <td>Computer account password out of sync with AD</td>
                </tr>
                <tr>
                    <td><span class="status-bad">There are currently no logon servers available</span></td>
                    <td>Cannot reach Domain Controller - DNS or network issue</td>
                </tr>
                <tr>
                    <td><span class="status-warn">The remote computer requires Network Level Authentication</span></td>
                    <td>NLA enabled but credentials cannot be verified</td>
                </tr>
                <tr>
                    <td><span class="status-bad">Remote Desktop can't connect to the remote computer</span></td>
                    <td>RDP disabled, firewall blocking, or service stopped</td>
                </tr>
                <tr>
                    <td><span class="status-warn">The user name or password is incorrect</span></td>
                    <td>Wrong credentials, locked account, or trust issue</td>
                </tr>
                <tr>
                    <td><span class="status-bad">An authentication error has occurred</span></td>
                    <td>Kerberos/time sync issue or NLA problem</td>
                </tr>
            </table>
        </div>

        <div class="section" id="section3">
            <h2>3. Step-by-Step Troubleshooting</h2>
            
            <h3>Step 3.1: Verify Basic Connectivity</h3>
            <div class="step">
                <span class="step-number">1</span>
                <div class="step-content">
                    <strong>Ping the server by IP address</strong>
                    <div class="code-block">ping &lt;server-ip&gt;</div>
                </div>
            </div>
            <div class="step">
                <span class="step-number">2</span>
                <div class="step-content">
                    <strong>Ping the server by hostname</strong>
                    <div class="code-block">ping &lt;server-hostname&gt;</div>
                </div>
            </div>
            <div class="alert alert-info">
                <strong>üí° Tip:</strong> If IP works but hostname fails = DNS issue
            </div>

            <h3>Step 3.2: Check Critical Ports</h3>
            <p>Test connectivity to required ports using PowerShell:</p>
            <table>
                <tr><th>Port</th><th>Service</th><th>Test Command</th></tr>
                <tr><td><strong>389</strong></td><td>LDAP</td><td><code class="code-inline">Test-NetConnection &lt;DC-IP&gt; -Port 389</code></td></tr>
                <tr><td><strong>636</strong></td><td>LDAPS</td><td><code class="code-inline">Test-NetConnection &lt;DC-IP&gt; -Port 636</code></td></tr>
                <tr><td><strong>88</strong></td><td>Kerberos</td><td><code class="code-inline">Test-NetConnection &lt;DC-IP&gt; -Port 88</code></td></tr>
                <tr><td><strong>53</strong></td><td>DNS</td><td><code class="code-inline">Test-NetConnection &lt;DC-IP&gt; -Port 53</code></td></tr>
                <tr><td><strong>445</strong></td><td>SMB</td><td><code class="code-inline">Test-NetConnection &lt;DC-IP&gt; -Port 445</code></td></tr>
                <tr><td><strong>135</strong></td><td>RPC</td><td><code class="code-inline">Test-NetConnection &lt;DC-IP&gt; -Port 135</code></td></tr>
                <tr><td><strong>3389</strong></td><td>RDP</td><td><code class="code-inline">Test-NetConnection &lt;Server-IP&gt; -Port 3389</code></td></tr>
                <tr><td><strong>3268</strong></td><td>Global Catalog</td><td><code class="code-inline">Test-NetConnection &lt;DC-IP&gt; -Port 3268</code></td></tr>
            </table>

            <h3>Step 3.3: Verify Domain Controller Communication</h3>
            <div class="step">
                <span class="step-number">1</span>
                <div class="step-content">
                    <strong>Find available Domain Controllers</strong>
                    <div class="code-block">nltest /dsgetdc:&lt;domain-name&gt;</div>
                </div>
            </div>
            <div class="step">
                <span class="step-number">2</span>
                <div class="step-content">
                    <strong>Verify secure channel status</strong>
                    <div class="code-block">Test-ComputerSecureChannel -Verbose</div>
                </div>
            </div>
            <div class="step">
                <span class="step-number">3</span>
                <div class="step-content">
                    <strong>Check Netlogon service</strong>
                    <div class="code-block">Get-Service Netlogon</div>
                </div>
            </div>

            <h3>Step 3.4: Check DNS Configuration</h3>
            <div class="step">
                <span class="step-number">1</span>
                <div class="step-content">
                    <strong>View current DNS servers</strong>
                    <div class="code-block">Get-DnsClientServerAddress</div>
                </div>
            </div>
            <div class="step">
                <span class="step-number">2</span>
                <div class="step-content">
                    <strong>Test DNS resolution for domain</strong>
                    <div class="code-block">Resolve-DnsName &lt;domain-name&gt;</div>
                </div>
            </div>
            <div class="step">
                <span class="step-number">3</span>
                <div class="step-content">
                    <strong>Flush DNS cache</strong>
                    <div class="code-block">ipconfig /flushdns</div>
                </div>
            </div>
            <div class="step">
                <span class="step-number">4</span>
                <div class="step-content">
                    <strong>Register with DNS</strong>
                    <div class="code-block">ipconfig /registerdns</div>
                </div>
            </div>

            <h3>Step 3.5: Check Time Synchronization</h3>
            <div class="alert alert-warning">
                <strong>‚ö†Ô∏è Important:</strong> Kerberos requires time to be within 5 minutes of the DC!
            </div>
            <div class="step">
                <span class="step-number">1</span>
                <div class="step-content">
                    <strong>Check time status</strong>
                    <div class="code-block">w32tm /query /status</div>
                </div>
            </div>
            <div class="step">
                <span class="step-number">2</span>
                <div class="step-content">
                    <strong>Force time resync</strong>
                    <div class="code-block">w32tm /resync /force</div>
                </div>
            </div>

            <h3>Step 3.6: Check Firewall Status</h3>
            <div class="step">
                <span class="step-number">1</span>
                <div class="step-content">
                    <strong>View firewall profiles</strong>
                    <div class="code-block">Get-NetFirewallProfile | Select Name, Enabled</div>
                </div>
            </div>
            <div class="step">
                <span class="step-number">2</span>
                <div class="step-content">
                    <strong>Check RDP firewall rule</strong>
                    <div class="code-block">Get-NetFirewallRule -DisplayGroup "Remote Desktop" | Select DisplayName, Enabled</div>
                </div>
            </div>

            <h3>Step 3.7: Check RDP Configuration</h3>
            <div class="step">
                <span class="step-number">1</span>
                <div class="step-content">
                    <strong>Verify RDP is enabled</strong>
                    <div class="code-block">(Get-ItemProperty 'HKLM:\System\CurrentControlSet\Control\Terminal Server').fDenyTSConnections</div>
                    <p><span class="status-good">0 = RDP Enabled</span> &nbsp; <span class="status-bad">1 = RDP Disabled</span></p>
                </div>
            </div>
            <div class="step">
                <span class="step-number">2</span>
                <div class="step-content">
                    <strong>Check NLA (Network Level Authentication) status</strong>
                    <div class="code-block">(Get-ItemProperty 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp').UserAuthentication</div>
                    <p><span class="status-warn">1 = NLA Enabled (May block access)</span> &nbsp; <span class="status-good">0 = NLA Disabled</span></p>
                </div>
            </div>
            <div class="step">
                <span class="step-number">3</span>
                <div class="step-content">
                    <strong>Check Terminal Services status</strong>
                    <div class="code-block">Get-Service TermService</div>
                </div>
            </div>
        </div>

        <div class="section" id="section4">
            <h2>4. Access Methods When RDP Fails</h2>
            
            <h3>4.1 AWS EC2 Serial Console</h3>
            <ol>
                <li>Go to <strong>AWS Console ‚Üí EC2 ‚Üí Instances</strong></li>
                <li>Select the instance</li>
                <li>Click <strong>Connect ‚Üí EC2 Serial Console</strong> tab</li>
                <li>Click <strong>Connect</strong> (requires SAC enabled on instance)</li>
                <li>Type: <code class="code-inline">cmd</code> to start command prompt</li>
                <li>Type: <code class="code-inline">ch -sn cmd0001</code> to connect to channel</li>
            </ol>
            <div class="alert alert-danger">
                <strong>üî¥ Note:</strong> If SSM Agent is not online, Serial Console is the ONLY option!
            </div>

            <h3>4.2 Azure Serial Console</h3>
            <ol>
                <li>Go to <strong>Azure Portal ‚Üí Virtual Machines</strong></li>
                <li>Select the VM</li>
                <li>Under <strong>Support + troubleshooting</strong>, click <strong>Serial Console</strong></li>
                <li>Press <strong>Enter</strong> to activate SAC prompt</li>
                <li>Type: <code class="code-inline">cmd</code> then <code class="code-inline">ch -sn cmd0001</code></li>
            </ol>

            <h3>4.3 PowerShell Remoting</h3>
            <div class="code-block">Enter-PSSession -ComputerName &lt;server&gt; -Credential (Get-Credential)</div>
        </div>

        <div class="section" id="section5">
            <h2>5. Resolution Procedures</h2>
            
            <h3>5.1 Repair Trust Relationship</h3>
            <div class="alert alert-danger">
                <strong>üîê REQUIRES:</strong> Domain Admin credentials
            </div>
            <div class="code-block">Test-ComputerSecureChannel -Repair -Credential (Get-Credential)</div>
            <p>Or reset computer password:</p>
            <div class="code-block">Reset-ComputerMachinePassword -Credential (Get-Credential)</div>

            <h3>5.2 Rejoin Domain (If Trust Cannot Be Repaired)</h3>
            <div class="alert alert-danger">
                <strong>üîê REQUIRES:</strong> Local Admin + Domain Admin credentials
            </div>
            <div class="step">
                <span class="step-number">1</span>
                <div class="step-content">
                    <strong>Remove from domain (use local admin)</strong>
                    <div class="code-block">Remove-Computer -UnjoinDomainCredential (Get-Credential) -Force -Restart</div>
                </div>
            </div>
            <div class="step">
                <span class="step-number">2</span>
                <div class="step-content">
                    <strong>After restart, rejoin domain</strong>
                    <div class="code-block">Add-Computer -DomainName &lt;domain&gt; -Credential (Get-Credential) -Restart</div>
                </div>
            </div>

            <h3>5.3 Enable RDP</h3>
            <div class="code-block">Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name fDenyTSConnections -Value 0
Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
Restart-Service TermService -Force</div>

            <h3>5.4 Disable NLA (Temporary)</h3>
            <p><em>Use when trust is broken and NLA prevents login</em></p>
            <div class="code-block">Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name UserAuthentication -Value 0</div>

            <h3>5.5 Change DNS Server</h3>
            <div class="code-block">Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses ("10.0.0.1","10.0.0.2")</div>
        </div>

        <div class="section" id="section6">
            <h2>6. Escalation Criteria</h2>
            <div class="alert alert-warning">
                <strong>‚¨ÜÔ∏è Escalate to L2/L3 if:</strong>
            </div>
            <ul>
                <li>Trust repair fails after <strong>2 attempts</strong></li>
                <li>Domain Controller is unreachable from <strong>multiple servers</strong></li>
                <li>AWS/Azure Serial Console is <strong>not working</strong></li>
                <li>GPO is <strong>blocking changes</strong></li>
                <li><strong>Multiple servers</strong> affected simultaneously</li>
                <li>Issue persists after <strong>domain rejoin</strong></li>
                <li><strong>Customer production is down</strong></li>
            </ul>
        </div>

        <div class="section" id="section7">
            <h2>7. Quick Reference Commands</h2>
            <table>
                <tr><th>Task</th><th>Command</th></tr>
                <tr><td>Find DC</td><td><code class="code-inline">nltest /dsgetdc:&lt;domain&gt;</code></td></tr>
                <tr><td>Test Trust</td><td><code class="code-inline">Test-ComputerSecureChannel -Verbose</code></td></tr>
                <tr><td>Repair Trust</td><td><code class="code-inline">Test-ComputerSecureChannel -Repair -Credential (Get-Credential)</code></td></tr>
                <tr><td>Reset Password</td><td><code class="code-inline">Reset-ComputerMachinePassword -Credential (Get-Credential)</code></td></tr>
                <tr><td>Check Time</td><td><code class="code-inline">w32tm /query /status</code></td></tr>
                <tr><td>Sync Time</td><td><code class="code-inline">w32tm /resync /force</code></td></tr>
                <tr><td>Flush DNS</td><td><code class="code-inline">ipconfig /flushdns</code></td></tr>
                <tr><td>Register DNS</td><td><code class="code-inline">ipconfig /registerdns</code></td></tr>
                <tr><td>Test Port</td><td><code class="code-inline">Test-NetConnection &lt;IP&gt; -Port &lt;port&gt;</code></td></tr>
                <tr><td>Get DNS Servers</td><td><code class="code-inline">Get-DnsClientServerAddress</code></td></tr>
                <tr><td>Set DNS</td><td><code class="code-inline">Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses "IP"</code></td></tr>
                <tr><td>Check RDP</td><td><code class="code-inline">(Get-ItemProperty 'HKLM:\...\Terminal Server').fDenyTSConnections</code></td></tr>
                <tr><td>Enable RDP FW</td><td><code class="code-inline">Enable-NetFirewallRule -DisplayGroup "Remote Desktop"</code></td></tr>
                <tr><td>GPO Update</td><td><code class="code-inline">gpupdate /force</code></td></tr>
                <tr><td>Remote PS</td><td><code class="code-inline">Enter-PSSession -ComputerName &lt;server&gt; -Credential (Get-Credential)</code></td></tr>
            </table>
        </div>

        <div class="footer">
            <p><strong>Document Version:</strong> 1.0 | <strong>Last Updated:</strong> January 2026</p>
            <p>L1 Windows Server Troubleshooting Guide | Server-Diagnostics Repository</p>
        </div>
    </div>
</body>
</html>
